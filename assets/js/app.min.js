/*
 (c) 2023 IASI AI. All rights reserved.
 @link https://hackathon.is
 @link https://iasi.ai
*/
class Dialog{constructor(m,n){this.options={dialogClassName:null,dialogPlaceholderClassName:null,size:{x:0,y:0},position:{},autoShow:!0,autoClose:!1,closeOnEsc:!0,closeOnOutsideClick:!0,callback:{onBeforeShow:null,onShow:null,onClose:null},linkTo:null};this.options=Object.assign(this.options,n);this.create(m)}static isChild(m,n){n=n.getElementsByTagName("*");for(let b=0;b<n.length;b++)if(n[b]===m)return!0;return!1}static closeAll(){document.querySelectorAll("[dialog-id]").forEach(m=>{"function"===
typeof m.close&&m.close()})}create(m){this.dlg=document.createElement("div");this.dlgPlaceholder=document.createElement("div");this.dlgPlaceholder.classList.add("dialog-placeholder");this.dlg.classList.add("dialog");null!==this.options.dialogPlaceholderClassName&&this.dlgPlaceholder.classList.add(this.options.dialogPlaceholderClassName);null!==this.options.dialogClassName&&this.dlg.classList.add(this.options.dialogClassName);this.dlgPlaceholder.setAttribute("dialog-id",Math.random().toString(36).substring(2,
9));this.dlgPlaceholder.style.visibility="hidden";this.dlg.setAttribute("dialog-id",Math.random().toString(36).substring(2,9));this.dlg.innerHTML=m;document.body.appendChild(this.dlgPlaceholder);m=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0;let n=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0;if(null!==this.options.linkTo)this.options.linkTo.parentNode.insertBefore(this.dlg,this.options.linkTo.nextSibling),this.dlg.style.marginLeft=
void 0!==this.options.position.x?`${this.options.position.x}px`:0,this.dlg.style.marginTop=void 0!==this.options.position.y?`${this.options.position.y}px`:0;else{this.dlgPlaceholder.appendChild(this.dlg);var b=getComputedStyle(this.dlg);const a=b.getPropertyValue("width");b=b.getPropertyValue("height");this.options.size={x:a.match(/px/)?parseInt(a.replace(/px/,"")):a.match(/%/)?m*parseInt(a.replace(/%/,""))/100:this.dlg.offsetWidth,y:b.match(/px/)?parseInt(b.replace(/px/,"")):b.match(/%/)?n*parseInt(b.replace(/%/,
""))/100:this.dlg.offsetHeight};this.dlg.style.marginLeft=void 0!==this.options.position.x?`${this.options.position.x}px`:`${(m-parseInt(this.options.size.x))/2}px`;this.dlg.style.marginTop=void 0!==this.options.position.y?`${this.options.position.y}px`:`${(n-parseInt(this.options.size.y))/2}px`}this.options.autoClose&&setTimeout(()=>{this.close()},1E3*parseInt(this.options.autoClose));this.options.closeOnEsc&&document.addEventListener("keyup",a=>{let d=a.code;a=a.target;3===a.nodeType&&(a=a.parentNode);
/(ArrowUp|ArrowDown|Escape|Space)/.test(d)&&!/input|textarea/i.test(a.tagName)&&"Escape"===d&&this.isVisible()&&this.close()});this.options.closeOnOutsideClick&&this.dlgPlaceholder.addEventListener("click",a=>{a=a.target;this.isVisible()&&a!==this.dlg&&!Dialog.isChild(a,this.dlg)&&this.close()});this.options.autoShow&&this.show()}isVisible(){return this.dlgPlaceholder&&"visible"===this.dlgPlaceholder.style.visibility}isCreated(){return null!==this.dlgPlaceholder}close(){if(this.isVisible()){if("function"===
typeof this.options.callback.onClose)this.options.callback.onClose();this.dlg.parentNode.removeChild(this.dlg);this.dlgPlaceholder.parentNode.removeChild(this.dlgPlaceholder);this.dlgPlaceholder=null}}show(){if("function"===typeof this.options.callback.onBeforeShow)this.options.callback.onBeforeShow();this.dlgPlaceholder.style.visibility="visible";if("function"===typeof this.options.callback.onShow)this.options.callback.onShow()}}
const app=(()=>{function m(b,a=null){b=document.querySelectorAll(b);0<b.length&&b.forEach(d=>{let h=d.getAttribute("data-dlg"),g=document.querySelector(h);h&&g&&d.addEventListener("click",()=>{Dialog.closeAll();const p=new Dialog(g.innerHTML,{dialogClassName:"modal-dialog",dialogPlaceholderClassName:"dialog-placeholder",closeOnEsc:!0,closeOnOutsideClick:!1,callback:{onShow:()=>{document.body.classList.add("no-scroll")},onClose:()=>{document.body.classList.remove("no-scroll")}}});p.dlg.querySelectorAll("label[for]").forEach(t=>
{var r=t.htmlFor;let w=p.dlg.querySelector(`#${r}`);r&&w&&(r=`elem${Math.random().toString(16).slice(2)}`,w.id=r,t.htmlFor=r)});a&&a(p,d.dataset||null);const c=p.dlg.querySelector(".close-dialog");c&&c.addEventListener("click",t=>{t.preventDefault();t.stopPropagation();p.close()})})})}function n(b,a,d="error",h=0,g=!1){if(b){const p=b.querySelectorAll(".notification"),c=document.createElement("p");c.classList.add("notification","notification-sm");c.classList.remove("error","success","info","warning");
c.classList.add(d);c.innerHTML=a;g?(c.classList.add("notification-floating","notification-animation"),0<p.length&&(c.style.top=`${45*p.length+20}px`)):0<p.length&&(b.innerHTML="");b.appendChild(c);0<h&&setTimeout(()=>{c.classList.remove("notification","notification-sm","notification-inline","notification-animation","notification-floating","error","success","info","warning");c.innerHTML="";c.parentNode.removeChild(c)},1E3*h)}}return{spin:'<div class="spinner spinner-sm"></div>',api:async function(b,
a="GET",d=""){d={method:a,headers:{Accept:"application/json","Content-Type":"application/json"},body:d?JSON.stringify(d):""};"GET"!==a&&"HEAD"!==a||delete d.body;return await fetch(b,d)},route:function(){const b=["route","method","query"];var a=window.location.pathname;const d=window.location.hash,h={};if(a&&(a=a.replace(/^\/?|\/?$/g,"").split("/"),0<a.length))for(let g=0;g<b.length;g++)h[b[g]]=a[g];d&&(h.hash=d.substring(1));return h},menu:function(){let b=document.querySelector(".btn-menu"),a=document.querySelector(".slide-menu");
null!==b&&null!==a&&b.addEventListener("click",d=>{d.preventDefault();d.stopPropagation();const h=new Dialog(`<div class="container">${a.innerHTML}</div>`,{dialogClassName:"slide-menu-dialog",dialogPlaceholderClassName:"dialog-placeholder",position:{x:0,y:0},callback:{onShow:()=>{b.style.visibility="hidden";document.body.classList.add("no-scroll");document.querySelector(".logo").classList.add("logo-slide-menu")},onClose:()=>{b.style.visibility="visible";document.body.classList.remove("no-scroll");
document.querySelector(".logo").classList.remove("logo-slide-menu")}}});(d=h.dlg.querySelector("button.btn-slide-close"))&&d.addEventListener("click",g=>{g.preventDefault();g.stopPropagation();h.close()})})},render:function(){const b=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;var a=document.querySelector(".page");if(a){var d=a.querySelector("header");const h=a.querySelectorAll("section.events");a.querySelectorAll(".btn-register");d&&(a=window.innerHeight,d=d.offsetHeight,
h[0]&&720<window.screen.availWidth&&(h[0].style.minHeight=`${Math.round(a-d)}px`));m(".btn-register",g=>{const p=g.dlg.querySelector(".notification-placeholder"),c=g.dlg.querySelector("form[name=registration]");c.addEventListener("submit",k=>k.preventDefault());const t=c.querySelector("input[type=submit]"),r=c.querySelector("input[name=registrationType][value=Individual]"),w=c.querySelector("input[name=registrationType][value=Team]"),A=c.querySelector(".registrationTeam"),B=c.querySelector(".agreeJoinTeam"),
C=c.querySelector("input[name=firstName]"),D=c.querySelector("input[name=lastName]"),z=c.querySelector("input[name=email]"),E=c.querySelector("input[name=phone]"),J=c.querySelector("input[name=agreePartOfTeam]"),F=c.querySelector("input[name=teamName]"),u=c.querySelector(".team-container"),G=c.querySelector("button[name=teamMemberAdd]"),K=c.querySelector("input#challenge1"),L=c.querySelector("input#challenge2"),M=c.querySelector("input#challenge3"),N=c.querySelector("input[name=agreeTerms]");r&&r.addEventListener("click",
k=>{A.classList.add("hide");B.classList.remove("hide")});w&&w.addEventListener("click",k=>{A.classList.remove("hide");B.classList.add("hide")});u&&G&&G.addEventListener("click",k=>{k.preventDefault();k.stopPropagation();k=u.querySelectorAll(".teamMember").length;if(6>k){let x=Date.now().toString();document.createDocumentFragment();let q=document.createElement("fieldset");q.classList.add("teamMember","form-group","form-group-inline","cols-5-5-2");q.setAttribute("data-id",x);let H=document.createElement("div");
var e=document.createElement("input");e.classList.add("form-control","form-control-2pbb");e.id=`teamMemberName.${k}`;e.name=`teamMemberName.${k}`;e.type="text";e.placeholder="Enter team member name";H.appendChild(e);e=document.createElement("div");var f=document.createElement("input");f.classList.add("form-control","form-control-2pbb");f.id=`teamMemberEmail.${k}`;f.name=`teamMemberEmail.${k}`;f.type="text";f.placeholder="Enter team member e-mail address";e.appendChild(f);f=document.createElement("div");
let v=document.createElement("button");v.classList.add("btn","btn-sm","btn-remove-entry");v.id=`teamMemberDel.${k}`;v.name=`teamMemberDel.${k}`;v.setAttribute("data-id",x);v.innerHTML='<span data-icon="&#xe005;" class="ic-mr-5"></span> Remove';f.appendChild(v);q.appendChild(H);q.appendChild(e);q.appendChild(f);u.appendChild(q);u.querySelectorAll("button.btn-remove-entry").forEach(I=>{I.addEventListener("click",y=>{y=I.getAttribute("data-id");y=u.querySelector(`.teamMember[data-id="${y}"]`);y.parentNode.removeChild(y)})})}});
const l={type:null,name:{first:null,last:null},email:null,phone:null,joinTeam:0,team:{name:null,members:[]},challenge:0,termsConditions:0};t.addEventListener("click",k=>{try{l.type=r.checked?1:2;if(0===C.value.length||0===D.value.length||0===z.value.length||0===E.value.length)throw"Please make sure all required fields are filled in.";if(z.value.match(b))l.name.first=C.value.trim(),l.name.last=D.value.trim(),l.email=z.value.trim(),l.phone=E.value.trim();else throw"E-mail address is invalid. Please use a different one.";
if(1===l.type)l.joinTeam=J.checked?1:0;else if(2===l.type){if(0===F.value.length)throw"Please make sure you provide a name for your team.";l.team.name=F.value.trim();const e=u.querySelectorAll(".teamMember");if(0===e.length)throw"You haven't added any team members. Please add at least a team member or switch to individual registration.";e.forEach((f,x)=>{if(f.getAttribute("data-id")){const q=f.querySelector(`input[name="teamMemberName.${x}"]`).value.trim();f=f.querySelector(`input[name="teamMemberEmail.${x}"]`).value.trim();
if(0===q.length||0===f.length)throw"Team member name and e-mail address are mandatory.";if(f.match(b))l.team.members.push({name:q,email:f});else throw`Team member e-mail address for <strong>${q}</strong> is invalid. Please use a different one.`;}})}l.challenge=K.checked?1:L.checked?2:M.checked?3:0;if(0===l.challenge)throw"You haven't chosen the hackathon challenge.";l.termsConditions=N.checked?1:0;if(0===l.termsConditions)throw"Terms and Conditions must be agreed in order to complete hackathon registration.";
app.api("https://api.hackathon.is/api/registration/","POST",{action:"registration",value:l}).then(e=>e.json()).then(e=>{if(e.error)throw e.message;g.dlg.innerHTML=`<section class="registration-successful text-center"><span data-icon="&#xe001;" class="ic-colored ic-x3" style="--color:#28a745;"></span><h4>${e.message}</h4></section><nav class="form-buttons"><a href="#cancel" class="btn btn-cancel close-dialog">Close</a></nav>`;(e=g.dlg.querySelector(".close-dialog"))&&e.addEventListener("click",f=>
{f.preventDefault();f.stopPropagation();g.close()})}).catch(e=>{n(p,e,"error",10,!0)})}catch(e){n(p,e,"error",10,!0)}})})}}}})();(()=>{app.render();app.menu()})();
